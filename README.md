# DW CLI

**DW CLI** allows to execute queries and generate data directly from the command line.

**Supported Data Formats are:**

| Format  |      MimeType      |  Extension |
|----------|:-------------:|------:|
| Xml |  application/xml | .xml |
| Json |    application/json   |   .json |
| CSV | application/csv |   .csv |
| Properties | text/x-java-properties | .properties|
| TextPlain | text/plain | .txt|
| Yaml | application/yaml | .yaml|
| Binary | application/octet-stream| .bin|
    

**DW CLI is** compiled with [Graal AOT](https://www.graalvm.org/docs/reference-manual/aot-compilation/) for fast bootstrap so download the one for your target os.

## How to install it 


1. Download the zip [Mac](http://weave-cli.s3.amazonaws.com/native-cli-1.0.0-SNAPSHOT-native-distro-osx.zip) | [Linux](http://weave-cli.s3.amazonaws.com/native-cli-1.0.0-SNAPSHOT-native-distro-linux.zip)
2. Unzip the file on your `<home_directory>/.dw`
3. Add `<home_directory>/.dw/bin` to your PATH


## How to use is

In order to execute just go to the bin directory and execute the `dw` script
 
### Show documentation

  `> dw`
 
 ```bash
.........................................................................
.%%%%%....%%%%...%%%%%%...%%%%...%%...%%..%%%%%%...%%%%...%%..%%..%%%%%%.
.%%..%%..%%..%%....%%....%%..%%..%%...%%..%%......%%..%%..%%..%%..%%.....
.%%..%%..%%%%%%....%%....%%%%%%..%%.%.%%..%%%%....%%%%%%..%%..%%..%%%%...
.%%..%%..%%..%%....%%....%%..%%..%%%%%%%..%%......%%..%%...%%%%...%%.....
.%%%%%...%%..%%....%%....%%..%%...%%.%%...%%%%%%..%%..%%....%%....%%%%%%.
.........................................................................


Usage:

dw [-path <weavePath>]? [-input <name> <path>]* [-verbose]? [-output <outputPath>]? [[-main <nameIdentifier>] | <scriptContent>]

Arguments Detail:

 -path    | Path of jars or directories where weave files are being searched
 -input   | Declares a new input
 -verbose | Enable Verbose Mode
 -output  | Specifies output file for the transformation if not standard output will be used
 -main    | The full qualified name of the mapping to execute
```

### Query content from a file

Input file `users.json`

```json
[
  {
    "name": "User1",
    "age": 19
  },
  {
    "name": "User2",
    "age": 18
  },
  {
    "name": "User3",
    "age": 15
  },
  {
    "name": "User4",
    "age": 13
  },
  {
    "name": "User5",
    "age": 16
  }
]
```
 
Lets query users old enough to drink alcohol.

`> dw -input payload <fullpathToUser.json> "output application/json --- payload filter (item) -> item.age > 17"`


### Query content from standard input

`> cat <fullpathToUser.json> | dw "output application/json --- payload filter (item) -> item.age > 17"`

### Redirecting the output to a file

`> dw "output application/xml --- users: {( 1 to 100 map (item) -> {user: "User" ++ item} )}" >> out.xml` 


## CURL + DW => Power API Playground

An interesting use case for the CLI is to combine it with [curl](https://curl.haxx.se/)  

### Example query github commits

We can use github api to query commits of a repo.

We can easily get the first commit by doing.

`> curl "https://api.github.com/repos/mulesoft/mule/commits?per_page=5" | dw "payload[0]"`

Or we can get the message by doing

`> curl "https://api.github.com/repos/mulesoft/mule/commits?per_page=5" | dw "{message: payload[0].commit.message}"` 

### Post data generated by DW

This example will create an really big csv and it will stream it to the http server on localhost.

`> dw "output application/csv --- (1 to 10000000000000000000000) map (item) -> {name: 'User \$(item)'}" | curl -X POST  -T "/dev/stdin" http://localhost:8081/`

